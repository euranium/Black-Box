package main

import (
	"fmt"
	"github.com/gorilla/mux"
	"io/ioutil"
	"net/http"
	"os/exec"
)

type User struct {
	user_name  string
	first_name string
	last_name  string
	hash       string
}

var tasks = make(chan *exec.Cmd, 64)

func main() {

	//tasks := make(chan *exec.Cmd, 64)

	fmt.Println("main")
	r := mux.NewRouter()
	r.HandleFunc("/", home)
	r.HandleFunc("/login", login)
	r.HandleFunc("/{user}", users)
	r.HandleFunc("/{user}/files", files)
	r.HandleFunc("/{user}/files/{id}", file)

	r.HandleFunc("/java30/read", java30Read)
	r.HandleFunc("/java500/read", java500Read)
	r.HandleFunc("/java30/run", java30Run)
	r.HandleFunc("/java500/run", java500Run)

	http.Handle("/", r)
	http.ListenAndServe(":8080", r)
}

// home site
func home(w http.ResponseWriter, r *http.Request) {
	w.Write([]byte("home page\n"))
	return
}

// login page if needed, can just ust user hash instead of auth
func login(w http.ResponseWriter, r *http.Request) {
	w.Write([]byte("login\n"))
	return
}

// use home page
func users(w http.ResponseWriter, r *http.Request) {
	w.Write([]byte("home\n"))
	return
}

// all the user files
func files(w http.ResponseWriter, r *http.Request) {
	w.Write([]byte("files\n"))
	return
}

// specific user file
func file(w http.ResponseWriter, r *http.Request) {
	w.Write([]byte("user file\n"))
	return
}

func home(w http.ResponseWriter, r *http.Request) {
	w.Write([]byte("\n"))
	return
}

func java30Run(w http.ResponseWriter, r *http.Request) {
	tasks <- exec.Command("java", "java30", "rand")
	return
}

func java500Run(w http.ResponseWriter, r *http.Request) {
	return
}

func java30Read(w http.ResponseWriter, r *http.Request) {
	if CheckFile("~/Documents/cs/research/javaProg30Sec.txt") {
		data, err := ioutil.ReadFile("~/Documents/cs/research/javaProg30Sec.txt")
		if err != nil {
			w.Write([]byte("Error retrieving file\n"))
			return
		}
		w.Write(data)
	} else {
		w.Write([]byte("File not found\n"))
	}
	return
}

func java500Read(w http.ResponseWriter, r *http.Request) {
	if CheckFile("~/Documents/cs/research/javaProg500Sec.txt") {
		data, err := ioutil.ReadFile("~/Documents/cs/research/javaProg30Sec.txt")
		if err != nil {
			w.Write([]byte("Error retrieving file\n"))
			return
		}
		w.Write(data)
	} else {
		w.Write([]byte("File not found\n"))
	}
	return
}
